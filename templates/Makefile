MAIN := fname
OBJS := builtin.ml $(MAIN).ml lexer.cmo parser.cmo main.cmo

%.cmo: %.ml
	ocamlc -c $<

%.cmi: %.mli
	ocamlc -c $<

$(MAIN): $(OBJS)
	ocamlc -o $@ $^

lexer.ml: lexer.mll
	ocamllex -q $<

parser.ml: parser.mly
	ocamlyacc -q $<

parser.mli: parser.mly
	ocamlyacc -q $<

clean:
	rm -f *.cmo *.cmi lexer.ml parser.ml parser.mli $(MAIN)

# Dependencies generated by `ocamldep -bytecode *.mli *.ml`.
fname.cmo : builtin.cmo
builtin.cmo :
lexer.cmo : parser.cmi
main.cmo : parser.cmi lexer.cmo fname.cmo
parser.cmo : fname.cmo parser.cmi
parser.cmi : fname.cmo